
<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ãƒ’ã‚«ãƒªãƒ’ãƒ¥ãƒ¼ãƒãƒ³ã€€ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ç ”ä¿®ã‚¯ã‚¤ã‚ºï¼ˆé‹è»¢ï¼‹èº«ã ã—ãªã¿ï¼‰</title>
  <style>
    :root {
      --bg:#f7f7fb; --card:#ffffff; --text:#111827; --muted:#6b7280;
      --line:#e5e7eb; --ok:#16a34a; --ng:#dc2626; --btn:#111827;
    }
    body { margin:0; font-family: system-ui, -apple-system, "Hiragino Sans", "Noto Sans JP", sans-serif; background:var(--bg); color:var(--text); }
    header { padding:16px; border-bottom:1px solid var(--line); background:#fff; position:sticky; top:0; z-index:10; }
    header h1 { margin:0; font-size:16px; }
    header p { margin:6px 0 0; font-size:12px; color:var(--muted); }
    main { max-width:900px; margin:0 auto; padding:16px; }
    .card { background:var(--card); border:1px solid var(--line); border-radius:12px; padding:14px; }
    .row { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .pill { display:inline-block; padding:2px 10px; border:1px solid var(--line); border-radius:999px; font-size:12px; color:#374151; background:#fff; }
    .btn { padding:10px 12px; border:1px solid var(--line); border-radius:10px; background:#fff; cursor:pointer; font-weight:700; }
    .btn.primary { background:var(--btn); color:#fff; border-color:var(--btn); }
    .btn:disabled { opacity:.5; cursor:not-allowed; }
    .qno { font-size:12px; color:var(--muted); }
    .qtext { font-size:18px; font-weight:800; margin:6px 0 10px; line-height:1.35; }
    .choice { width:100%; text-align:left; padding:12px; border:1px solid var(--line); border-radius:12px; background:#fff; cursor:pointer; font-weight:700; }
    .choice:hover { background:#fafafa; }
    .choice.ok { border-color: rgba(22,163,74,.6); background: rgba(22,163,74,.08); }
    .choice.ng { border-color: rgba(220,38,38,.6); background: rgba(220,38,38,.08); }
    .explain { margin-top:10px; padding:10px; border-radius:10px; background:#fafafa; border:1px solid var(--line); }
    .explain h3 { margin:0 0 6px; font-size:13px; }
    .explain p { margin:0; font-size:13px; color:#111827; line-height:1.6; }
    .muted { color:var(--muted); font-size:12px; line-height:1.5; }
    .spacer { height:12px; }
    .grid2 { display:grid; grid-template-columns: 1fr 1fr; gap:10px; }
    @media (max-width:700px){ .grid2{ grid-template-columns:1fr; } .qtext{ font-size:17px; } }
    .resultBig { font-size:22px; font-weight:900; }
    .list { margin:10px 0 0; padding-left:18px; }
    .list li { margin:6px 0; }
  </style>
</head>
<body>
<header>
  <h1>ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ç ”ä¿®ã‚¯ã‚¤ã‚ºï¼ˆé‹è»¢ï¼‹èº«ã ã—ãªã¿ï¼‰</h1>
  <p>10å•ï¼ä¸‰æŠã€‚æœ€å¾Œã«æ¡ç‚¹ï¼†è§£èª¬ã€‚é–“é•ãˆãŸå•é¡Œã ã‘å¾©ç¿’ã§ãã¾ã™ã€‚</p>
</header>

<main>
  <div class="card" id="screenStart">
    <div class="row" style="justify-content:space-between;">
      <div class="row">
        <span class="pill">Webã ã‘</span>
        <span class="pill">ãƒ‡ãƒ¼ã‚¿ä¿å­˜ãªã—</span>
        <span class="pill">éŸ³ã‚ã‚Š</span>
      </div>
      <div class="row">
        <button class="btn" id="btnToggleSound" type="button">ğŸ”Š éŸ³ï¼šON</button>
      </div>
    </div>

    <div class="spacer"></div>
    <p class="muted">
      â€»iPhone/Safariã¯ã€Œæœ€åˆã®æ“ä½œï¼ˆãƒœã‚¿ãƒ³æŠ¼ä¸‹ï¼‰ã€ãŒãªã„ã¨éŸ³ãŒé³´ã‚‰ãªã„ã“ã¨ãŒã‚ã‚‹ã®ã§ã€
      é–‹å§‹ãƒœã‚¿ãƒ³ã§éŸ³ã‚’â€œè§£ç¦â€ã—ã¾ã™ã€‚
    </p>

    <div class="spacer"></div>
    <div class="row">
      <button class="btn primary" id="btnStart" type="button">é–‹å§‹ã™ã‚‹</button>
      <button class="btn" id="btnStartGrooming" type="button">èº«ã ã—ãªã¿å¤šã‚ã§é–‹å§‹</button>
      <button class="btn" id="btnStartDriving" type="button">é‹è»¢å¤šã‚ã§é–‹å§‹</button>
    </div>
  </div>

  <div class="card" id="screenQuiz" style="display:none;">
    <div class="row" style="justify-content:space-between;">
      <div class="qno" id="qno"></div>
      <div class="row">
        <span class="pill" id="pillCategory">ã‚«ãƒ†ã‚´ãƒª</span>
        <button class="btn" id="btnQuit" type="button">ä¸­æ–­</button>
      </div>
    </div>

    <div class="qtext" id="qtext"></div>

    <div class="grid2" id="choices"></div>

    <div class="explain" id="explain" style="display:none;">
      <h3 id="judgeTitle">è§£èª¬</h3>
      <p id="explainText"></p>
    </div>

    <div class="spacer"></div>
    <div class="row">
      <button class="btn primary" id="btnNext" type="button" disabled>æ¬¡ã¸</button>
      <button class="btn" id="btnRetryWrong" type="button" style="display:none;">é–“é•ã„ã ã‘å¾©ç¿’</button>
      <button class="btn" id="btnRestart" type="button" style="display:none;">æœ€åˆã‹ã‚‰</button>
    </div>

    <div class="spacer"></div>
    <div class="muted" id="progress"></div>
  </div>

  <div class="card" id="screenResult" style="display:none;">
    <div class="row" style="justify-content:space-between;">
      <div class="resultBig" id="resultTitle"></div>
      <button class="btn" id="btnBackToStart" type="button">ãƒˆãƒƒãƒ—ã¸</button>
    </div>

    <div class="spacer"></div>
    <div id="resultBody"></div>

    <div class="spacer"></div>
    <div class="row">
      <button class="btn primary" id="btnReviewWrong2" type="button">é–“é•ã„ã ã‘å¾©ç¿’</button>
      <button class="btn" id="btnRestart2" type="button">æœ€åˆã‹ã‚‰</button>
    </div>
  </div>
</main>

<script>
/** =========================
 *  è¨­å®šï¼šéŸ³ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆãƒªãƒã‚¸ãƒˆãƒªå†…ï¼‰
 *  ========================= */
const SOUND = {
  correct: "./sounds/correct.mp3",
  wrong: "./sounds/wrong.mp3",
};

let soundEnabled = true;
let seCorrect = new Audio(SOUND.correct);
let seWrong   = new Audio(SOUND.wrong);

// iOSå¯¾ç­–ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œã§ä¸€åº¦ã ã‘ã€Œç„¡éŸ³å†ç”Ÿ/å†ç”Ÿæº–å‚™ã€ã£ã½ã„ã“ã¨ã‚’ã™ã‚‹
let audioUnlocked = false;
async function unlockAudioOnce(){
  if (audioUnlocked) return;
  audioUnlocked = true;
  try {
    seCorrect.volume = 0; seWrong.volume = 0;
    await seCorrect.play(); seCorrect.pause(); seCorrect.currentTime = 0;
    await seWrong.play();   seWrong.pause();   seWrong.currentTime   = 0;
  } catch(e) {
    // ãƒ–ãƒ©ã‚¦ã‚¶ã«ã‚ˆã£ã¦ã¯ã“ã“ã§å¤±æ•—ã—ã¦ã‚‚ã€å¾Œã§é³´ã‚‹ã“ã¨ãŒã‚ã‚‹ã®ã§ç„¡è¦–
  } finally {
    seCorrect.volume = 1; seWrong.volume = 1;
  }
}

function playCorrect(){
  if (!soundEnabled) return;
  try { seCorrect.currentTime = 0; seCorrect.play(); } catch(e){}
}
function playWrong(){
  if (!soundEnabled) return;
  try { seWrong.currentTime = 0; seWrong.play(); } catch(e){}
}

/** =========================
 *  ã‚¯ã‚¤ã‚ºå•é¡Œï¼ˆé‹è»¢ï¼‹èº«ã ã—ãªã¿ï¼‰
 *  =========================
 * type: "driving" or "grooming"
 */
const QUESTIONS = [
  // é‹è»¢ãƒ»å®‰å…¨
  {
    type:"driving",
    q:"é€è¿ã§æœ€å„ªå…ˆã«â€œå®ˆã‚‹ã¹ãâ€ã‚‚ã®ã¯ã©ã‚Œï¼Ÿ",
    choices:["å®šåˆ»ï¼ˆé…ã‚Œãªã„ã“ã¨ï¼‰","ä¹—å®¢ã®å®‰å…¨","ç‡ƒè²»"],
    answer:1,
    exp:"é…ã‚Œã¦ã‚‚å®‰å…¨ã¯å®ˆã‚Œã‚‹ã‘ã©ã€å®‰å…¨ã‚’å´©ã™ã¨å…¨éƒ¨çµ‚ã‚ã‚‹ã€‚æ€¥ãŒãšã€ä½™è£•ã®é‹è»¢ãŒæ­£è§£ã€‚"
  },
  {
    type:"driving",
    q:"ç‹­ã„é“ã§å¯¾å‘è»Šã¨ã™ã‚Œé•ã†ã¨ãã€åŸºæœ¬ã®è€ƒãˆæ–¹ã¯ï¼Ÿ",
    choices:["ã“ã¡ã‚‰ãŒå…ˆã«çªã£è¾¼ã‚€","ç›¸æ‰‹ã«è­²ã‚‰ã›ã‚‹","å®‰å…¨ã«æ­¢ã¾ã‚Œã‚‹é€Ÿåº¦ã§â€œè­²ã‚‹å‰æâ€ã§é€²ã‚€"],
    answer:2,
    exp:"é€è¿ã¯â€œã¶ã¤ã‘ãªã„â€ãŒæœ€å„ªå…ˆã€‚æ­¢ã¾ã‚Œã‚‹é€Ÿåº¦ã¨ã‚¹ãƒšãƒ¼ã‚¹ç¢ºä¿ã€‚è­²ã‚‹å‰æãŒå¼·ã„ã€‚"
  },
  {
    type:"driving",
    q:"é›¨ã®æ—¥ã€åˆ¶å‹•è·é›¢ï¼ˆæ­¢ã¾ã‚‹è·é›¢ï¼‰ã‚’æ¸›ã‚‰ã™ãŸã‚ã«ä¸€ç•ªåŠ¹ãã®ã¯ï¼Ÿ",
    choices:["è»Šé–“è·é›¢ã‚’å¢—ã‚„ã™","ã‚¯ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã‚’å¤šç”¨","ãƒ©ã‚¤ãƒˆã‚’æ¶ˆã—ã¦é›†ä¸­"],
    answer:0,
    exp:"è»Šé–“ï¼å‘½ã®ãƒãƒƒãƒ•ã‚¡ã€‚é›¨ã¯è·¯é¢ãŒæ»‘ã‚‹ã®ã§ã€è»Šé–“ã‚’å¢—ã‚„ã—ã¦æ—©ã‚ã®æ¸›é€ŸãŒåŸºæœ¬ã€‚"
  },
  {
    type:"driving",
    q:"äº¤å·®ç‚¹ã§ä¸€æ™‚åœæ­¢ã€‚åœæ­¢ç·šã®æ‰‹å‰ã§æ­¢ã¾ã£ãŸå¾Œã€æ¬¡ã«ã‚„ã‚‹ã¹ãã¯ï¼Ÿ",
    choices:["ãã®ã¾ã¾ä¸€æ°—ã«ç™ºé€²","å®‰å…¨ç¢ºèªã—ãªãŒã‚‰â€œå¾è¡Œã§å‰ã«å‡ºã‚‹â€","å¾Œç¶šãŒã„ã‚‹ã®ã§æ€¥ã„ã§åˆæµ"],
    answer:1,
    exp:"è¦‹ãˆãªã„è§’ã¯â€œäºŒæ®µéšåœæ­¢â€ãŒå®‰å…¨ã€‚æ­¢ã¾ã‚‹â†’è¦‹ãˆã‚‹ä½ç½®ã¸å¾è¡Œâ†’å†ç¢ºèªã€‚"
  },
  {
    type:"driving",
    q:"ä¹—å®¢ãŒä¹—ã‚Šé™ã‚Šã™ã‚‹ç¬é–“ã€é‹è»¢å¸­ã§æœ€ã‚‚é‡è¦ãªã®ã¯ï¼Ÿ",
    choices:["ã‚¨ãƒ³ã‚¸ãƒ³ã‚’å¼·ããµã‹ã™","ãƒ‰ã‚¢ã®é–‹é–‰ã¨å‘¨å›²ï¼ˆè‡ªè»¢è»Šãƒ»æ­©è¡Œè€…ï¼‰ç¢ºèª","ã‚¹ãƒãƒ›ã§æ¬¡ã®å ´æ‰€ç¢ºèª"],
    answer:1,
    exp:"ä¹—é™ä¸­ã¯äº‹æ•…ã®èµ·ç‚¹ã€‚è‡ªè»¢è»Šã®å·»ãè¾¼ã¿ãƒ»ãƒ‰ã‚¢é–‹ã‘äº‹æ•…ã‚’æ½°ã™ã®ãŒãƒ—ãƒ­ã€‚"
  },

  // èº«ã ã—ãªã¿ãƒ»æ¥é‡
  {
    type:"grooming",
    q:"é€è¿ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã®èº«ã ã—ãªã¿ã§â€œä¿¡ç”¨ã‚’è½ã¨ã™â€ä»£è¡¨ä¾‹ã¯ï¼Ÿ",
    choices:["æ¸…æ½”ã§ã‚·ãƒ³ãƒ—ãƒ«ãªæœè£…","å¼·ã„é¦™æ°´ã®åŒ‚ã„","åæœ­ã‚’è¦‹ãˆã‚‹ä½ç½®ã«ã¤ã‘ã‚‹"],
    answer:1,
    exp:"é¦™ã‚Šã¯å¥½ã¿ãŒåˆ†ã‹ã‚Œã€ä½“èª¿ä¸è‰¯ã®åŸå› ã«ã‚‚ã€‚åŸºæœ¬ã¯â€œç„¡è‡­å¯„ã‚Šâ€ãŒå®‰å…¨ã€‚"
  },
  {
    type:"grooming",
    q:"åˆ¶æœãƒ»ç§æœã©ã¡ã‚‰ã§ã‚‚å…±é€šã—ã¦å¤§äº‹ãªã®ã¯ï¼Ÿ",
    choices:["ã‚·ãƒ¯ãƒ»æ±šã‚ŒãŒç›®ç«‹ã¤çŠ¶æ…‹","æ¸…æ½”æ„Ÿï¼ˆæ±šã‚Œ/æ¯›ç‰/ãƒ¨ãƒ¬/é´ï¼‰","æ´¾æ‰‹ãªã‚¢ã‚¯ã‚»ã§å€‹æ€§"],
    answer:1,
    exp:"é€è¿ã¯â€œå®‰å¿ƒã®è¦‹ãŸç›®â€ãŒå•†å“ã€‚æœã‚ˆã‚Šã€æ¸…æ½”æ„Ÿã¨é´ã®çŠ¶æ…‹ãŒåŠ¹ãã€‚"
  },
  {
    type:"grooming",
    q:"é«ªå‹ãƒ»ãƒ’ã‚²ã«ã¤ã„ã¦ã€é€è¿ã®ç¾å ´ã§åŸºæœ¬ã®è€ƒãˆæ–¹ã¯ï¼Ÿ",
    choices:["è‡ªç”±ã€‚ãªã‚“ã§ã‚‚OK","æ¸…æ½”ã§æ•´ã£ã¦ã„ã‚‹ã“ã¨ï¼ˆä¼¸ã³ã™ã/å¯ãã›/ç„¡ç²¾ãƒ’ã‚²ã¯é¿ã‘ã‚‹ï¼‰","æµè¡Œã‚’å„ªå…ˆ"],
    answer:1,
    exp:"â€œã ã‚‰ã—ãªã„â€å°è±¡ã¯ã‚¯ãƒ¬ãƒ¼ãƒ ç›´çµã€‚æ•´ã£ã¦ã‚‹ï¼å®‰å¿ƒã€‚"
  },
  {
    type:"grooming",
    q:"è»Šå†…ã®å°è±¡ã§ã‚¯ãƒ¬ãƒ¼ãƒ ã«ãªã‚Šã‚„ã™ã„ã®ã¯ï¼Ÿ",
    choices:["åºŠã®ã‚´ãƒŸãƒ»ãƒ‹ã‚ªã‚¤ãƒ»åŸƒ","çª“ãŒå°‘ã—æ›‡ã‚‹","é™ã‹ã«é‹è»¢ã™ã‚‹"],
    answer:0,
    exp:"è»Šå†…ã¯â€œç¬¬äºŒã®æ¥å®¢ã‚¹ãƒšãƒ¼ã‚¹â€ã€‚ã‚´ãƒŸãƒ»ãƒ‹ã‚ªã‚¤ã¯ä¸€ç™ºã‚¢ã‚¦ãƒˆã«ãªã‚Šã‚„ã™ã„ã€‚"
  },
  {
    type:"grooming",
    q:"ä¹—å®¢ã‹ã‚‰ã€Œå¯’ã„/æš‘ã„ã€ã¨è¨€ã‚ã‚ŒãŸã¨ãã®åŸºæœ¬å¯¾å¿œã¯ï¼Ÿ",
    choices:["æˆ‘æ…¢ã—ã¦ã‚‚ã‚‰ã†","ç„¡è¦–ã—ã¦é‹è»¢ã«é›†ä¸­","ä¸€è¨€å—ã‘æ­¢ã‚ã¦ã‹ã‚‰èª¿æ•´ï¼ˆã§ããªã„æ™‚ã¯ç†ç”±ã¨ä»£æ¡ˆï¼‰"],
    answer:2,
    exp:"ã¾ãšå—ã‘æ­¢ã‚ã‚‹â†’èª¿æ•´ã€‚å®‰å…¨é‹è»¢ã¨ä¸¡ç«‹ã§ããªã„å ´åˆã¯èª¬æ˜ã—ä»£æ¡ˆï¼ˆå¸­ç§»å‹•ãªã©ï¼‰ã€‚"
  },
];

/** =========================
 *  ç”»é¢è¦ç´ 
 *  ========================= */
const screenStart  = document.getElementById("screenStart");
const screenQuiz   = document.getElementById("screenQuiz");
const screenResult = document.getElementById("screenResult");

const btnStart = document.getElementById("btnStart");
const btnStartGrooming = document.getElementById("btnStartGrooming");
const btnStartDriving = document.getElementById("btnStartDriving");
const btnToggleSound = document.getElementById("btnToggleSound");

const qno = document.getElementById("qno");
const qtext = document.getElementById("qtext");
const choicesEl = document.getElementById("choices");
const explainBox = document.getElementById("explain");
const explainText = document.getElementById("explainText");
const judgeTitle = document.getElementById("judgeTitle");
const btnNext = document.getElementById("btnNext");
const btnQuit = document.getElementById("btnQuit");
const progress = document.getElementById("progress");
const pillCategory = document.getElementById("pillCategory");

const btnRetryWrong = document.getElementById("btnRetryWrong");
const btnRestart = document.getElementById("btnRestart");

const resultTitle = document.getElementById("resultTitle");
const resultBody = document.getElementById("resultBody");
const btnBackToStart = document.getElementById("btnBackToStart");
const btnReviewWrong2 = document.getElementById("btnReviewWrong2");
const btnRestart2 = document.getElementById("btnRestart2");

/** =========================
 *  çŠ¶æ…‹
 *  ========================= */
let quiz = [];              // å‡ºé¡Œç”¨ï¼ˆ10å•ï¼‰
let index = 0;
let answered = false;
let wrongIds = [];          // é–“é•ãˆãŸå•é¡Œã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆquizå†…ï¼‰
let correctCount = 0;

/** =========================
 *  ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
 *  ========================= */
function shuffle(arr){
  const a = arr.slice();
  for (let i=a.length-1; i>0; i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]] = [a[j],a[i]];
  }
  return a;
}

function pick10(mode){
  // mode: "mix" | "grooming" | "driving"
  const driving = QUESTIONS.filter(q => q.type==="driving");
  const grooming= QUESTIONS.filter(q => q.type==="grooming");

  if (mode==="grooming"){
    // èº«ã ã—ãªã¿å¤šã‚ï¼šèº«ã ã—ãªã¿6 + é‹è»¢4ï¼ˆåˆè¨ˆ10ï¼‰
    return shuffle(grooming).slice(0,6).concat(shuffle(driving).slice(0,4));
  }
  if (mode==="driving"){
    // é‹è»¢å¤šã‚ï¼šé‹è»¢6 + èº«ã ã—ãªã¿4
    return shuffle(driving).slice(0,6).concat(shuffle(grooming).slice(0,4));
  }
  // mixï¼šãƒãƒ©ãƒ³ã‚¹è‰¯ã
  return shuffle(QUESTIONS).slice(0,10);
}

function categoryLabel(type){
  return type==="grooming" ? "èº«ã ã—ãªã¿/æ¥é‡" : "é‹è»¢/å®‰å…¨";
}

/** =========================
 *  ç”»é¢åˆ¶å¾¡
 *  ========================= */
function show(screen){
  screenStart.style.display  = "none";
  screenQuiz.style.display   = "none";
  screenResult.style.display = "none";
  screen.style.display       = "block";
}

function resetState(){
  index = 0;
  answered = false;
  wrongIds = [];
  correctCount = 0;
  btnRetryWrong.style.display = "none";
  btnRestart.style.display = "none";
  btnNext.style.display = "inline-block";
  btnNext.disabled = true;
}

function renderQuestion(){
  const item = quiz[index];
  answered = false;
  btnNext.disabled = true;
  explainBox.style.display = "none";
  choicesEl.innerHTML = "";

  qno.textContent = `ç¬¬ ${index+1} å• / ${quiz.length}`;
  pillCategory.textContent = categoryLabel(item.type);
  qtext.textContent = item.q;
  progress.textContent = `æ­£è§£ï¼š${correctCount}ã€€ï½œã€€é–“é•ã„ï¼š${wrongIds.length}`;

  item.choices.forEach((c, i) => {
    const b = document.createElement("button");
    b.className = "choice";
    b.type = "button";
    b.textContent = c;
    b.addEventListener("click", () => choose(i));
    choicesEl.appendChild(b);
  });
}

function choose(choiceIndex){
  if (answered) return;
  answered = true;

  const item = quiz[index];
  const buttons = Array.from(choicesEl.querySelectorAll("button.choice"));

  const isCorrect = (choiceIndex === item.answer);
  if (isCorrect){
    correctCount++;
    playCorrect();
    judgeTitle.textContent = "âœ… æ­£è§£";
  } else {
    wrongIds.push(index);
    playWrong();
    judgeTitle.textContent = "âŒ ä¸æ­£è§£";
  }

  // è‰²ä»˜ã‘
  buttons.forEach((b, i) => {
    if (i === item.answer) b.classList.add("ok");
    if (i === choiceIndex && i !== item.answer) b.classList.add("ng");
    b.disabled = true;
  });

  explainText.textContent = item.exp;
  explainBox.style.display = "block";
  btnNext.disabled = false;
}

function next(){
  if (!answered) return;
  index++;
  if (index >= quiz.length){
    finish();
    return;
  }
  renderQuestion();
}

function finish(){
  show(screenResult);

  const total = quiz.length;
  const score = correctCount;
  const rate = Math.round((score/total)*100);

  resultTitle.textContent = `çµæœï¼š${score}/${total}ï¼ˆ${rate}%ï¼‰`;

  // ã–ã£ãã‚Šè©•ä¾¡
  let comment = "";
  if (rate === 100) comment = "å®Œç’§ã€‚ã‚‚ã†å›ãŒæ•™å®˜ã€‚";
  else if (rate >= 80) comment = "ã‹ãªã‚Šè‰¯ã„ã€‚ç¾å ´ã§â€œäº‹æ•…ã‚Šã«ãã„äººâ€ã®é¦™ã‚Šã€‚";
  else if (rate >= 60) comment = "åˆæ ¼ãƒ©ã‚¤ãƒ³ã€‚å¼±ç‚¹ã ã‘æ½°ã™ã¨ä¸€æ°—ã«å¼·ããªã‚‹ã€‚";
  else comment = "ä¼¸ã³ã—ã‚ãŒã§ã‹ã„ã€‚é–“é•ã„å¾©ç¿’ã ã‘å›ã™ã¨æœ€çŸ­ã§ä¸ŠãŒã‚‹ã€‚";

  const wrongListHtml = wrongIds.length
    ? `<p><strong>é–“é•ãˆãŸå•é¡Œ</strong>ï¼ˆ${wrongIds.length}ä»¶ï¼‰</p>
       <ol class="list">
         ${wrongIds.map(i => `<li>${quiz[i].q} <span class="pill">${categoryLabel(quiz[i].type)}</span></li>`).join("")}
       </ol>`
    : `<p><strong>é–“é•ã„ã‚¼ãƒ­</strong>ã€‚ä»Šæ—¥ã¯å‹ã¡ã€‚</p>`;

  resultBody.innerHTML = `
    <p class="muted">${comment}</p>
    ${wrongListHtml}
    <p class="muted">â€»ã€Œé–“é•ã„ã ã‘å¾©ç¿’ã€ã§ã€åŒã˜å•é¡Œã ã‘ã‚‚ã†ä¸€å‘¨ã§ãã¾ã™ã€‚</p>
  `;

  btnReviewWrong2.disabled = (wrongIds.length === 0);
}

function start(mode){
  resetState();
  quiz = shuffle(pick10(mode)); // å‡ºé¡Œé †ã‚‚ã‚·ãƒ£ãƒƒãƒ•ãƒ«
  show(screenQuiz);
  renderQuestion();
}

/** =========================
 *  ã‚¤ãƒ™ãƒ³ãƒˆ
 *  ========================= */
btnToggleSound.addEventListener("click", () => {
  soundEnabled = !soundEnabled;
  btnToggleSound.textContent = soundEnabled ? "ğŸ”Š éŸ³ï¼šON" : "ğŸ”‡ éŸ³ï¼šOFF";
});

btnStart.addEventListener("click", async () => {
  await unlockAudioOnce();
  start("mix");
});
btnStartGrooming.addEventListener("click", async () => {
  await unlockAudioOnce();
  start("grooming");
});
btnStartDriving.addEventListener("click", async () => {
  await unlockAudioOnce();
  start("driving");
});

btnNext.addEventListener("click", next);

btnQuit.addEventListener("click", () => {
  // ä¸­æ–­ï¼ãƒˆãƒƒãƒ—ã¸æˆ»ã™
  show(screenStart);
});

btnBackToStart.addEventListener("click", () => {
  show(screenStart);
});

function retryWrong(){
  if (!wrongIds.length){
    alert("é–“é•ã„ãŒãªã„ã®ã§å¾©ç¿’ã¯ä¸è¦ã§ã™ï¼");
    return;
  }
  // é–“é•ã„å•é¡Œã ã‘ã§æ–°ã—ã„ã‚¯ã‚¤ã‚ºã‚’ä½œã‚Šç›´ã™
  const wrongQuestions = wrongIds.map(i => quiz[i]);
  quiz = shuffle(wrongQuestions);
  resetState();
  // é–“é•ã„å¾©ç¿’ã¯ â€œä»Šå›ã®å¾©ç¿’ã§ã®æ­£è§£æ•°â€ ã‚’æ¸¬ã‚‹ãŸã‚ã«ã‚«ã‚¦ãƒ³ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆ
  wrongIds = [];
  correctCount = 0;
  show(screenQuiz);
  renderQuestion();
}

function restartAll(){
  show(screenStart);
}

btnRetryWrong.addEventListener("click", retryWrong);
btnRestart.addEventListener("click", restartAll);
btnReviewWrong2.addEventListener("click", retryWrong);
btnRestart2.addEventListener("click", restartAll);
</script>
</body>
</html>
